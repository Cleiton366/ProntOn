var pdTrackingLib=function(){var e={utils:{},services:{}};return e.utils.ajaxRequest=function(){function e(e,i,n,t,s,o,r){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState==XMLHttpRequest.DONE)if(a.status>=200&&a.status<=299)o(a.responseText&&""!=a.responseText?JSON.parse(a.responseText):null);else{r({status:a.status,data:a.responseText});const e=new CustomEvent("httpErrorEvent",{detail:{error:{response:a}}});window.dispatchEvent(e)}},a.open(e,i,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json"),n&&a.setRequestHeader("Authorization",n),a.setRequestHeader("pd-app-client-id",s.id||s.name),a.setRequestHeader("pd-app-client-version",s.version),"POST"==e?a.send(JSON.stringify(t)):a.send()}return{ajaxRequest:e}}(),e.utils.cookies=function(){function i(e){var i=document.cookie.match(new RegExp(e+"=([^;]+)"));try{i&&(i=JSON.parse(i[1]))}catch(n){i&&(i=i[1])}return i}function n(e,i){i=i||r,document.cookie=[e,"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=",i].join("")}function t(e,i){var n=[e,"=",JSON.stringify(i),"; domain=",r,"; path=/;"].join("");document.cookie=n}function s(e,i){if(!i[e]||"function"!=typeof i[e])throw new Error("Invalid "+e+" function")}function o(i){s("setCookie",i),s("getCookie",i),s("removeCookie",i),Object.assign({},e.utils.cookies,i)}var r=".passeidireto.com";return{setCookie:t,getCookie:i,removeCookie:n,overrideCookiesUtils:o}}(),e.utils.debounce=function(){function e(e,i,n){var t;return function(){var s=this,o=arguments,r=function(){t=null,n||e.apply(s,o)},a=n&&!t;clearTimeout(t),t=setTimeout(r,i),a&&e.apply(s,o)}}return{debounce:e}}(),e.services.eventTracking=function(){function i(e){o=e}function n(){return window.location.search.slice(1).split("&").filter(function(e){return e.startsWith("pd_")}).join("&")}function t(i,t,s){t.PdUtm=n();var r={SessionId:s,EventName:i,Data:t,TrackingLibVersion:"10.0.17"};console.log("[PD Tracking Lib]",i,JSON.stringify(r));var a="https://tracking-api.passeidireto.com",c=a+"/track";e.utils.ajaxRequest.ajaxRequest("POST",c,o.sessionKey,r,o.clientData,function(){},function(e){console.error("[PD Tracking Lib] Something went wrong with event tracking",e)})}function s(i,n,r){var a=e.services.sessionTracking.getSessionId(),c=parseInt("500"),u=parseInt("10000")/c;a>0||o&&o.anonymous?t(i,n,a):u>r?(console.warn("[PD Tracking Lib] Session Tracking is not ready, delaying to send. Attempt:",++r),setTimeout(function(){s(i,n,r)},c)):console.error("[PD Tracking Lib] Session Tracking is not ready, giving up")}var o;return{track:function(e,i){return s(e,i,0)},init:i}}(),e.services.materialReadTracking=function(){function i(i){c=i,e.services.sessionActivity.isSessionActive()?(n(),a=setInterval(function(){e.services.eventTracking.track("MaterialRead",{MaterialId:i,MaterialReadInterval:r})},r),e.services.sessionActivity.bindSessionInactiveCallback(s)):s()}function n(){a&&(clearInterval(a),a=null),e.services.sessionActivity.unbindSessionInactiveCallback(s),e.services.sessionActivity.unbindSessionActiveCallback(t)}function t(){i(c),e.services.sessionActivity.unbindSessionActiveCallback(t)}function s(){n(),e.services.sessionActivity.bindSessionActiveCallback(t)}function o(){n(),c=null}const r=parseInt("10000");var a,c;return{startMaterialRead:i,stopMaterialRead:o}}(),e.services.materialWatchedTracking=function(){function i(i){a=i,n(),r=setInterval(function(){e.services.eventTracking.track(o,{MaterialId:i,MaterialWatchedInterval:s,OnTab:!document.hidden})},s)}function n(){r&&(clearInterval(r),r=null)}function t(){n(),a=null}const s=parseInt("10000"),o="MaterialWatched";var r,a;return{startMaterialWatched:i,stopMaterialWatched:t}}(),e.services.sessionActivity=function(){function i(e){if(!e.anonymous){if(!e.userId||e.userId<1)throw new Error("Invalid userId");if(!e.sessionKey)throw new Error("Invalid sessionKey")}if(!e.currentLocation)throw new Error("Invalid currentLocation");if(!e.clientData)throw new Error("Invalid clientData");if((!e.clientData.id||e.clientData.id<1)&&!e.clientData.name)throw new Error("Invalid clientData.id and clientData.name");if(!e.clientData.version)throw new Error("Invalid clientData.version")}function n(n,t,s){t="undefined"==typeof t?function(){}:t,s="undefined"==typeof s?function(){}:s,i(n),k=n,e.services.sessionTracking.init(k),e.services.eventTracking.init(k),n.anonymous?t():e.services.sessionTracking.trackSession(t,s)}function t(){o(),e.services.sessionTracking.trackSession()}function s(){o(!0)}function o(e){g?clearTimeout(g):e||(console.log("[PD Tracking Lib]","Session active"),setTimeout(function(){p.forEach(function(e){e()})})),g=setTimeout(function(){g=null,console.log("[PD Tracking Lib]","Session inative"),T.forEach(function(e){e()})},e?0:f)}function r(e){p.push(e)}function a(e){var i=p.indexOf(e);p.splice(i,1)}function c(e){T.push(e)}function u(e){var i=T.indexOf(e);T.splice(i,1)}function l(){return!!g}var v=e.utils.debounce;const d=500,f=parseInt("600000");var k,g,p=[],T=[];const y=v.debounce(t,d);return{initSession:n,userActivityEventListener:y,userInactivityEventListener:s,bindSessionActiveCallback:r,unbindSessionActiveCallback:a,bindSessionInactiveCallback:c,unbindSessionInactiveCallback:u,isSessionActive:l}}(),e.services.sessionTracking=function(){function i(e){const i=c.clientData.id;return e+"_"+i}function n(e){c=e}function t(n,t){const s=window.location.href,u=document.referrer,l=e.utils.cookies.getCookie("first_accessed_page"),v=e.utils.cookies.getCookie("first_accessed_page_referer"),d=e.utils.cookies.getCookie("session_key")||c.sessionKey;if(d){const f=c.userId;e.utils.cookies.setCookie(i(o),(new Date).toISOString());var k="https://session-tracking-api.passeidireto.com",g=k+"/session/"+f+"/track";const p={currentUrl:s,referrerUrl:u,FirstAccessedPage:l,FirstAccessedPageReferrer:v};console.log("[PD Tracking Lib]","SessionTracking",JSON.stringify(p)),e.utils.ajaxRequest.ajaxRequest("POST",g,d,p,c.clientData,function(s){s?(a=s.SessionId,e.utils.cookies.setCookie(i(r),a),n()):(a=-1,t())},function(n){console.error("[PD Tracking Lib] Something went wrong with session tracking",n),a=-1,503!==n.status&&(e.utils.cookies.removeCookie(i(o)),e.utils.cookies.removeCookie(i(r))),t(n)})}}function s(n,s){n="undefined"==typeof n?function(){}:n,s="undefined"==typeof s?function(){}:s;var c=e.utils.cookies.getCookie(i(o));if(!c)return t(n,s);c=new Date(c);var u=new Date,l=Math.abs(c-u);l>=parseInt("3600000")?t(n,s):a||(a=e.utils.cookies.getCookie(i(r)),n())}const o="last-session-tracking-call",r="last-session-tracking-id";var a,c;return{init:n,trackSession:s,getSessionId:function(){return a},getSessionKey:function(){return c.sessionKey}}}(),{overrideCookiesUtils:e.utils.cookies.overrideCookiesUtils,initSession:e.services.sessionActivity.initSession,userActivityEventListener:e.services.sessionActivity.userActivityEventListener,userInactivityEventListener:e.services.sessionActivity.userInactivityEventListener,trackEvent:e.services.eventTracking.track,startMaterialRead:e.services.materialReadTracking.startMaterialRead,stopMaterialRead:e.services.materialReadTracking.stopMaterialRead,startMaterialWatched:e.services.materialWatchedTracking.startMaterialWatched,stopMaterialWatched:e.services.materialWatchedTracking.stopMaterialWatched,version:"10.0.17"}}();